---
- name: Get latest yay tag from GitHub
  github_release:
    user: Jguer
    repo: yay
    action: latest_release
  register: yay_latest

- name: Download latest yay
  get_url:
    url: 'https://github.com/Jguer/yay/releases/download/{{ yay_latest }}/yay_{{ yay_latest[1:] }}_x86_64.tar.gz'
    dest: /tmp/yay.tar.gz

- name: Install yay
  pacman:
    name: /tmp/yay.tar.gz
    state: present

# - name: Install base-devel group
#   pacman:
#     name: base-devel
#     state: present

# - name: Clone AUR yay repo
#   git:
#     repo: https://aur.archlinux.org/yay.git
#     dest: /tmp/yay
#     version: master
#   become_user: '{{ username }}'

# - name: Build and install yay
#   command:
#     chdir: /tmp/yay
#     cmd: 'makepkg --syncdeps --install --noconfirm'
#     creates: yay-*.pkg.tar.zst
#   become_user: '{{ username }}'
